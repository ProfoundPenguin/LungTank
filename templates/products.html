{% extends 'base.html' %}
{% block extra_body_class %}
<div id="back_button" onclick="window.history.back();" class="button_hover_effect_parent black">

    <div id="hover_effect"></div>
    <svg width="9" height="15" viewBox="0 0 9 15" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.5 14L1 7.5L7.5 1" stroke="#CDE8E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    <p class="pc_only">Back</p>                    
</div>
{% endblock extra_body_class %}
{% block content %}

<div id="products_page" class="section">
    <h1>Our Products</h1>
    <div id="control">
        <div id="search">
            <input type="text" placeholder="Search Product">
            <div id="reset_search" onclick="reset_search()">
                <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1.3623 1L15.3623 15" stroke="black" stroke-width="2" stroke-linecap="round"/>
                    <path d="M15 1L0.999999 15" stroke="black" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    
            </div>
        </div>
        <div id="flex">
            <p id="list_items">
                Listed {{ products|length }} Products
            </p>
            <div id="buttons">
                <div id="sort" class="button">Sort By
                    <svg width="13" height="8" viewBox="0 0 13 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L6.5 7L12 1" stroke="#CDE8E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>    
                </div>
                <div id="sort" class="button">Filter By
                    <svg width="13" height="8" viewBox="0 0 13 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L6.5 7L12 1" stroke="#CDE8E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>                                
                </div>
            </div>
        </div>
    </div>
    <div id="products">
        {% for product in products %}
        <div id="product" data-name="{{ product.name }}">
            <div id="image">
                {% if product.images.all %}
                    <img src="{{ product.images.all.0.image_400.url }}" alt="{{ product.name }} Image">
                {% else %}
                    <p>Could not get the image</p>
                {% endif %}
            </div>
            <div id="text">
                <div id="des">
                    <p id="name">
                        {{ product.name }}
                    </p>
                    <p id="price">
                        {{ product.price }} USD
                    </p>
                </div>
                <button  onclick="addToCart({{ product.id }})" class="button_hover_effect_parent black b{{ product.id }}">
                    <div id="hover_effect"></div>
                    <svg width="30" height="30" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M38 20C38 29.9411 29.9411 38 20 38C10.0589 38 2 29.9411 2 20" stroke="#89A19F" stroke-width="3" stroke-linecap="round"/>
                        <path d="M20 0.5C19.1716 0.5 18.5 1.17157 18.5 2C18.5 2.82843 19.1716 3.5 20 3.5L20 0.5ZM20 3.5C29.1127 3.5 36.5 10.8873 36.5 20L39.5 20C39.5 9.23045 30.7696 0.5 20 0.5L20 3.5Z" fill="#89A19F"/>
                        </svg>
                        
                        
                    <p>
                    Add To Cart
                </p>
                </button>
            </div>
        </div>
            
        </div>
        {% empty %}
            <p>Could not get any products at the moment</p>
        {% endfor %}
    </div>
</div>

<script>
    const products = document.querySelectorAll('#products_page #product')
    const search_input = document.querySelector("#control #search input")

    function search(searchTerm) {
        if (searchTerm != "") {
            document.querySelector("#control #search").classList.add('searched')
        } else {
            document.querySelector("#control #search").classList.remove('searched')
        }
        // Convert the search term to lowercase for case-insensitive matching
        const lowerCaseTerm = searchTerm.toLowerCase();

        // Iterate over each product element
        products.forEach(product => {
            // Get the product name from the data attribute
            const productName = product.getAttribute('data-name').toLowerCase();

            // Check if the product name includes the search term
            if (productName.includes(lowerCaseTerm)) {
                product.style.display = 'block'; // Show matching products
            } else {
                product.style.display = 'none'; // Hide non-matching products
            }
        });
    }

    function reset_search() {
        search_input.value="";
        search("")
    }

    search_input.addEventListener('input', ()=> {
        console.log(search_input.value);
        search(search_input.value)
    })
</script>

{% endblock content %}

